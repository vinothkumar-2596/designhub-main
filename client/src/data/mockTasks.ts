import { Task, DashboardStats } from '@/types';

const today = new Date();
const addDays = (days: number) => new Date(today.getTime() + days * 24 * 60 * 60 * 1000);

export const mockTasks: Task[] = [
  {
    id: '1',
    title: 'Annual Report Cover Design',
    description: 'Design a professional cover for the 2024 annual report. Should include company logo, year, and a modern corporate aesthetic.',
    category: 'brochure',
    urgency: 'urgent',
    status: 'in_progress',
    requesterId: '3',
    requesterName: 'John Requester',
    requesterDepartment: 'Marketing',
    assignedTo: '2',
    assignedToName: 'Sarah Creative',
    deadline: addDays(5),
    proposedDeadline: addDays(6),
    deadlineApprovalStatus: 'pending',
    isModification: false,
    changeCount: 2,
    changeHistory: [
      {
        id: 'ch-1',
        type: 'update',
        field: 'description',
        oldValue: 'Initial brief submitted.',
        newValue: 'Updated brief with latest branding notes.',
        userId: '2',
        userName: 'Sarah Creative',
        userRole: 'designer',
        createdAt: addDays(-1),
      },
    ],
    files: [
      { id: 'f1', name: 'brand_guidelines.pdf', url: '#', type: 'input', size: 1677722, uploadedAt: new Date(), uploadedBy: '3' },
      { id: 'f2', name: 'previous_cover.jpg', url: '#', type: 'input', size: 862208, uploadedAt: new Date(), uploadedBy: '3' },
    ],
    comments: [
      {
        id: 'c1',
        taskId: '1',
        userId: '2',
        userName: 'Sarah Creative',
        userRole: 'designer',
        content: 'Started working on initial concepts. Will share drafts by tomorrow.',
        createdAt: new Date(),
      },
    ],
    createdAt: addDays(-2),
    updatedAt: new Date(),
  },
  {
    id: '2',
    title: 'Social Media Campaign Graphics',
    description: 'Create a set of 5 social media graphics for the upcoming product launch campaign. Sizes needed: Instagram post, Instagram story, Facebook post, LinkedIn post, Twitter header.',
    category: 'social_media_creative',
    urgency: 'normal',
    status: 'pending',
    requesterId: '3',
    requesterName: 'John Requester',
    requesterDepartment: 'Marketing',
    deadline: addDays(7),
    proposedDeadline: undefined,
    deadlineApprovalStatus: undefined,
    isModification: false,
    changeCount: 1,
    changeHistory: [],
    files: [
      { id: 'f3', name: 'product_photos.zip', url: '#', type: 'input', size: 13002342, uploadedAt: new Date(), uploadedBy: '3' },
      { id: 'f4', name: 'campaign_brief.docx', url: '#', type: 'input', size: 430080, uploadedAt: new Date(), uploadedBy: '3' },
    ],
    comments: [],
    createdAt: addDays(-1),
    updatedAt: addDays(-1),
  },
  {
    id: '3',
    title: 'Event Banner - Tech Conference',
    description: 'Large format banner (3m x 1m) for the upcoming tech conference booth. Must include QR code for registration.',
    category: 'banner',
    urgency: 'normal',
    status: 'clarification_required',
    requesterId: '3',
    requesterName: 'John Requester',
    requesterDepartment: 'Marketing',
    assignedTo: '2',
    assignedToName: 'Sarah Creative',
    deadline: addDays(10),
    proposedDeadline: undefined,
    deadlineApprovalStatus: undefined,
    isModification: false,
    changeCount: 3,
    changeHistory: [
      {
        id: 'ch-2',
        type: 'file_added',
        field: 'files',
        oldValue: '',
        newValue: 'event_details.pdf',
        userId: '3',
        userName: 'John Requester',
        userRole: 'staff',
        createdAt: addDays(-2),
      },
    ],
    files: [
      { id: 'f5', name: 'event_details.pdf', url: '#', type: 'input', size: 1003520, uploadedAt: new Date(), uploadedBy: '3' },
    ],
    comments: [
      {
        id: 'c2',
        taskId: '3',
        userId: '2',
        userName: 'Sarah Creative',
        userRole: 'designer',
        content: 'Need clarification on the QR code destination URL. Also, should we include speaker photos?',
        createdAt: new Date(),
      },
    ],
    createdAt: addDays(-3),
    updatedAt: new Date(),
  },
  {
    id: '4',
    title: 'Modify Approved Poster Design',
    description: 'Update the approved poster design with new date and venue information. This is a modification of previously approved design.',
    category: 'flyer',
    urgency: 'urgent',
    status: 'pending',
    requesterId: '3',
    requesterName: 'John Requester',
    requesterDepartment: 'Marketing',
    deadline: addDays(4),
    proposedDeadline: undefined,
    deadlineApprovalStatus: undefined,
    isModification: true,
    approvalStatus: 'pending',
    changeCount: 4,
    changeHistory: [],
    files: [
      { id: 'f6', name: 'original_poster.pdf', url: '#', type: 'input', size: 2411725, uploadedAt: new Date(), uploadedBy: '3' },
      { id: 'f7', name: 'new_details.txt', url: '#', type: 'input', size: 12288, uploadedAt: new Date(), uploadedBy: '3' },
    ],
    comments: [],
    createdAt: today,
    updatedAt: today,
  },
  {
    id: '5',
    title: 'Company Newsletter Template',
    description: 'Create a reusable newsletter template for monthly company communications. Should be easy to update with new content.',
    category: 'website_assets',
    urgency: 'normal',
    status: 'under_review',
    requesterId: '3',
    requesterName: 'John Requester',
    requesterDepartment: 'HR',
    assignedTo: '2',
    assignedToName: 'Sarah Creative',
    deadline: addDays(3),
    proposedDeadline: undefined,
    deadlineApprovalStatus: undefined,
    isModification: false,
    changeCount: 2,
    changeHistory: [],
    files: [
      { id: 'f8', name: 'template_draft_v1.pdf', url: '#', type: 'output', size: 3250586, uploadedAt: new Date(), uploadedBy: '2' },
    ],
    comments: [
      {
        id: 'c3',
        taskId: '5',
        userId: '2',
        userName: 'Sarah Creative',
        userRole: 'designer',
        content: 'First draft ready for review. Please check the layout and color scheme.',
        createdAt: new Date(),
      },
    ],
    createdAt: addDays(-5),
    updatedAt: new Date(),
  },
  {
    id: '6',
    title: 'Product Launch Poster',
    description: 'A3 poster for the new product launch event in the main lobby.',
    category: 'flyer',
    urgency: 'normal',
    status: 'completed',
    requesterId: '3',
    requesterName: 'John Requester',
    requesterDepartment: 'Marketing',
    assignedTo: '2',
    assignedToName: 'Sarah Creative',
    deadline: addDays(-2),
    proposedDeadline: undefined,
    deadlineApprovalStatus: undefined,
    isModification: false,
    changeCount: 1,
    changeHistory: [],
    files: [
      { id: 'f9', name: 'final_poster.pdf', url: '#', type: 'output', size: 1468006, uploadedAt: new Date(), uploadedBy: '2' },
      { id: 'f10', name: 'final_poster.png', url: '#', type: 'output', size: 778240, uploadedAt: new Date(), uploadedBy: '2' },
    ],
    comments: [
      {
        id: 'c4',
        taskId: '6',
        userId: '3',
        userName: 'John Requester',
        userRole: 'staff',
        content: 'Looks great! Thank you for the quick turnaround.',
        createdAt: new Date(),
      },
    ],
    createdAt: addDays(-10),
    updatedAt: addDays(-2),
  },
];

export const calculateStats = (tasks: Task[], userId?: string, role?: string): DashboardStats => {
  let filteredTasks = tasks;
  
  if (role === 'staff' && userId) {
    filteredTasks = tasks.filter(t => t.requesterId === userId);
  }

  return {
    totalTasks: filteredTasks.length,
    pendingTasks: filteredTasks.filter(t => t.status === 'pending').length,
    inProgressTasks: filteredTasks.filter(t => t.status === 'in_progress').length,
    completedTasks: filteredTasks.filter(t => t.status === 'completed').length,
    urgentTasks: filteredTasks.filter(t => t.urgency === 'urgent' && t.status !== 'completed').length,
    pendingApprovals: tasks.filter(t => t.approvalStatus === 'pending').length,
  };
};
